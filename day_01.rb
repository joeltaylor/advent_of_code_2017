require 'minitest/autorun'
require 'benchmark'
################################################################################
# Part 1
#
# Task
# Find the _sum_ of all digits that match the _next_ digit in the list. The
# list is circular, so the digit after the last digit is the first digit in the
# list.
#
# Constraints:
# Find the solution in 1ms or less.
#
# Examples:
# - `1122` produces 3
# - `1111` produces 4
# - `1234` produces 0
# - `91212129` produces 9
#
#
# Input: Assuming integers and not a string
# Output: Integer
#
# Current solution:
# Time complexity: O(n)
# Space complexity: O(n)
#
# Part 2
#
# Task
# Find the _sum_ of all digits that match the _next_ digit that is halfway around
# the list. The list is circular, so the digit after the last digit is the
# first digit in the list.
#
# Constraints:
# Find the solution in 1ms or less.
#
# Examples:
# - `1212` produces 6
# - `1221` produces 0
# - `123425` produces 4
# - `123123` produces 12
# - `12131415` produces 4
#
#
# Input: Integers with an even number of digits
# Output: Integer
#
# Current solution:
# Time complexity: O(n)
# Space complexity: O(n)
#
################################################################################

class CaptchaSolver
  # Part 1
  def self.solve(captcha)
    total = 0

    int_list = captcha.to_s.chars.map(&:to_i)

    int_list << int_list[0] unless int_list.length == 1

    int_list.each_with_index do |item, index|
      total += item if int_list[index + 1] == item
    end

    total
  end

  # Part 2
  def self.solve_part_two(captcha)
    total = 0

    int_list = captcha.to_s.chars.map(&:to_i)
    steps_forward = int_list.size / 2

    int_list += int_list[0...steps_forward]

    int_list.each_with_index do |item, index|
      total += item if int_list[index + steps_forward] == item
    end

    total
  end
end

class CaptachaSolverTest < Minitest::Test
  def test_example_cases
    assert_equal(3, CaptchaSolver.solve(1122))
    assert_equal(4, CaptchaSolver.solve(1111))
    assert_equal(0, CaptchaSolver.solve(1234))
    assert_equal(9, CaptchaSolver.solve(91212129))

    assert_equal(6,  CaptchaSolver.solve_part_two(1212))
    assert_equal(0,  CaptchaSolver.solve_part_two(1221))
    assert_equal(4,  CaptchaSolver.solve_part_two(123425))
    assert_equal(12, CaptchaSolver.solve_part_two(123123))
    assert_equal(4,  CaptchaSolver.solve_part_two(12131415))
  end

  def test_other_cases
    assert_equal(18, CaptchaSolver.solve(91299))
    assert_equal(0,  CaptchaSolver.solve(01))

    assert_equal(18, CaptchaSolver.solve_part_two(991299))
    assert_equal(2,  CaptchaSolver.solve_part_two(11))
  end

  def test_timing_of_provided_captcha
    captcha = 494751136895345894732582362629576539599184296195318162664695189393364372585778868512194863927652788149779748657989318645936221887731542718562643272683862627537378624843614831337441659741281289638765171452576466381314558821636595394981788588673443769343597851883955668818165723174939893841654914556681324133667446412138511724424292394454166623639872425168644336248217213826339741267546823779383343362789527461579565822966859349777937921933694912369552152772735167832762563719664315456987186713541153781499646178238762644186484381142249926194743713139262596264878458636595896487362658672224346241358667234115974528626523648311919886566497837217169673923935143386823757293148719377821517314629812886912412829924484513493885672343964151252433622341141661523814465991516961684511941471572895453711624986269342398786175846925783918686856442684489873327497698963658862856336682422797551251489126661954848572297228765445646745256499679451426358865477844467458533962981852292513358871483321161973583245698763531598395467675529181496911117769834127516441369261275244225978893617456524385518493112272169767775861256649728253754964675812534546226295535939697352141217337346738553495616832783757866928174519145357234834584788253893618549484385733283627199445369658339175644484859385884574943219267922729967571943843794565736975716174727852348441254492886794362934343868643337828637454277582276962353246357835493338372219824371517526474283541714897994127864461433627894831268659336264234436872715374727211764167739169341999573855627775114848275268739159272518673316753672995297888734844388928439859359992475637439771269232916542385876779616695129412366735112593669719335783511355773814685491876721452994714318863716542473187246351548626157775143333161422867924437526253865859969947366972895674966845993244925218766937543487875485647329995285821739359369998935331986126873726737672159265827566443794515755939813676194755474477224152139987944419463371386499841415227734673733555261543871359797796529847861748979527579985757964742667473767269248335229836818297477665453189662485548925521497365877771665365728224394427883312135322325169141784
    time = time_in_milliseconds { CaptchaSolver.solve(captcha) }
    assert(time < 1.0, "Greater than 1 ms: #{time}")

    time = time_in_milliseconds { CaptchaSolver.solve_part_two(captcha) }
    assert(time < 1.0, "Greater than 1 ms: #{time}")
  end

  def time_in_milliseconds(&block)
    time = Benchmark.realtime do
      yield block
    end
    time * 1000
  end

  # def test_timing_of_provided_captcha_doubled_for_giggles
  #   captcha = 494751136895345894732582362629576539599184296195318162664695189393364372585778868512194863927652788149779748657989318645936221887731542718562643272683862627537378624843614831337441659741281289638765171452576466381314558821636595394981788588673443769343597851883955668818165723174939893841654914556681324133667446412138511724424292394454166623639872425168644336248217213826339741267546823779383343362789527461579565822966859349777937921933694912369552152772735167832762563719664315456987186713541153781499646178238762644186484381142249926194743713139262596264878458636595896487362658672224346241358667234115974528626523648311919886566497837217169673923935143386823757293148719377821517314629812886912412829924484513493885672343964151252433622341141661523814465991516961684511941471572895453711624986269342398786175846925783918686856442684489873327497698963658862856336682422797551251489126661954848572297228765445646745256499679451426358865477844467458533962981852292513358871483321161973583245698763531598395467675529181496911117769834127516441369261275244225978893617456524385518493112272169767775861256649728253754964675812534546226295535939697352141217337346738553495616832783757866928174519145357234834584788253893618549484385733283627199445369658339175644484859385884574943219267922729967571943843794565736975716174727852348441254492886794362934343868643337828637454277582276962353246357835493338372219824371517526474283541714897994127864461433627894831268659336264234436872715374727211764167739169341999573855627775114848275268739159272518673316753672995297888734844388928439859359992475637439771269232916542385876779616695129412366735112593669719335783511355773814685491876721452994714318863716542473187246351548626157775143333161422867924437526253865859969947366972895674966845993244925218766937543487875485647329995285821739359369998935331986126873726737672159265827566443794515755939813676194755474477224152139987944419463371386499841415227734673733555261543871359797796529847861748979527579985757964742667473767269248335229836818297477665453189662485548925521497365877771665365728224394427883312135322325169141784494751136895345894732582362629576539599184296195318162664695189393364372585778868512194863927652788149779748657989318645936221887731542718562643272683862627537378624843614831337441659741281289638765171452576466381314558821636595394981788588673443769343597851883955668818165723174939893841654914556681324133667446412138511724424292394454166623639872425168644336248217213826339741267546823779383343362789527461579565822966859349777937921933694912369552152772735167832762563719664315456987186713541153781499646178238762644186484381142249926194743713139262596264878458636595896487362658672224346241358667234115974528626523648311919886566497837217169673923935143386823757293148719377821517314629812886912412829924484513493885672343964151252433622341141661523814465991516961684511941471572895453711624986269342398786175846925783918686856442684489873327497698963658862856336682422797551251489126661954848572297228765445646745256499679451426358865477844467458533962981852292513358871483321161973583245698763531598395467675529181496911117769834127516441369261275244225978893617456524385518493112272169767775861256649728253754964675812534546226295535939697352141217337346738553495616832783757866928174519145357234834584788253893618549484385733283627199445369658339175644484859385884574943219267922729967571943843794565736975716174727852348441254492886794362934343868643337828637454277582276962353246357835493338372219824371517526474283541714897994127864461433627894831268659336264234436872715374727211764167739169341999573855627775114848275268739159272518673316753672995297888734844388928439859359992475637439771269232916542385876779616695129412366735112593669719335783511355773814685491876721452994714318863716542473187246351548626157775143333161422867924437526253865859969947366972895674966845993244925218766937543487875485647329995285821739359369998935331986126873726737672159265827566443794515755939813676194755474477224152139987944419463371386499841415227734673733555261543871359797796529847861748979527579985757964742667473767269248335229836818297477665453189662485548925521497365877771665365728224394427883312135322325169141784
  #   time = Benchmark.realtime do
  #     CaptchaSolver.solve(captcha)
  #   end
  #   milliseconds = time * 1000
  #   assert(milliseconds < 1.0, "Took greater than 1 ms: #{milliseconds}")
  # end
end
